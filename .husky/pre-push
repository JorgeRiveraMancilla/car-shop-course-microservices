#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Ejecutando pre-push hooks..."

echo "ğŸ” Analizando archivos no utilizados..."
dotnet husky run --name analyze-unused-files

if [ $? -ne 0 ]; then
    echo "âš ï¸  Advertencia en anÃ¡lisis de archivos, pero continuando..."
fi

echo "ğŸ§ª Ejecutando tests unitarios..."
dotnet husky run --name run-unit-tests

if [ $? -ne 0 ]; then
    echo "âŒ Error en tests. Push cancelado."
    exit 1
fi

echo "ğŸ³ Verificando configuraciÃ³n de Docker Compose..."
dotnet husky run --name docker-compose-check

if [ $? -eq 0 ]; then
    echo "ğŸ³ Iniciando servicios con Docker Compose..."
    dotnet husky run --name docker-compose-up
    
    if [ $? -eq 0 ]; then
        echo "â³ Esperando que los servicios estÃ©n listos..."
        dotnet husky run --name docker-health-check
        
        echo "âœ… Pre-push hooks completados exitosamente!"
        echo ""
        echo "ğŸŒ Servicios disponibles:"
        echo "  - Gateway: http://localhost:6001"
        echo "  - Auction Service: http://localhost:7001"
        echo "  - Search Service: http://localhost:7002"
        echo "  - Identity Service: http://localhost:5001"
        echo "  - RabbitMQ Management: http://localhost:15672"
        echo ""
        echo "ğŸ’¡ Usa 'docker-compose logs [service-name]' para ver logs especÃ­ficos"
    else
        echo "âŒ Error al iniciar Docker Compose. Push cancelado."
        exit 1
    fi
else
    echo "âŒ Error en configuraciÃ³n de Docker Compose. Push cancelado."
    exit 1
fi